# Prometheus Configuration for Fintegrate Integration Platform
# Scrapes metrics from customer services, RabbitMQ, and PostgreSQL

global:
  scrape_interval: 15s  # Scrape targets every 15 seconds
  evaluation_interval: 15s  # Evaluate alerting rules every 15 seconds
  external_labels:
    cluster: 'fintegrate-local'
    environment: 'development'

# Alerting configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: []  # No alertmanager in local dev (add for production)

# Load alerting rules
rule_files:
  - '/etc/prometheus/prometheus-rules.yml'

# Scrape configurations
scrape_configs:
  # Customer Service instances (your FastAPI services)
  - job_name: 'customer-service'
    static_configs:
      - targets:
          - 'customer_service_1:8000'
          - 'customer_service_2:8000'
        labels:
          service: 'customer-service'
          instance_type: 'api'
    metrics_path: '/metrics'
    scrape_interval: 10s  # More frequent for API metrics

  # RabbitMQ metrics (queue depth, message rates, consumer count)
  - job_name: 'rabbitmq'
    static_configs:
      - targets:
          - 'rabbitmq-exporter:9419'
        labels:
          service: 'rabbitmq'
          instance_type: 'message-broker'
    scrape_interval: 15s

  # PostgreSQL metrics (connection pool, query performance, table sizes)
  - job_name: 'postgresql'
    static_configs:
      - targets:
          - 'postgres-exporter:9187'
        labels:
          service: 'postgresql'
          instance_type: 'database'
    scrape_interval: 30s  # Less frequent for database metrics

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets:
          - 'localhost:9090'
        labels:
          service: 'prometheus'
          instance_type: 'monitoring'
